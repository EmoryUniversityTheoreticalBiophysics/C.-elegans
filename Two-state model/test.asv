% timerange = [60 150];
 close all
inputname = {'control_oct','control_nov','ibuprofen','mutant'};

factor1 = @(I,I1) I1(3)+(1./(1+(I/I1(2)))); 
factor1fit = @(I1a,I1b,I1c,x) I1a+(I1c./(1+(x/I1b))); 
 timerange = [60 150];

for j = 1:4
    load(inputname{j})
    speed = speed(timerange(1):timerange(2),:);
    fspeed_part = fspeed_part(:,timerange(1):timerange(2));
    
    
%     factor1 = @(I,I1) (I1(1)+I);

    I1{j} = Func_fit(speed,I,S,factor1);
    Probval1(j) = Prob_cal(I1{j},I,speed,factor1);
    
    figure(1)
    subplot(2,2,j)
    plot(linspace(0,200),-factor1(linspace(0,200),I1{j})./var(factor1(linspace(0,200),I1{j})))
    hold
    plot(I_part,vmax_part./var(vmax_part),'O')
    title(inputname{j})
    
    vdf = fspeed_part./(factor1(I_part,I1{j})'*ones(size(speed,1),1)');
    figure(2)
    subplot(2,2,j)
    plot(vdf')
    ylabel('speed')
    xlabel('time')
    title(inputname{j})
    
 
   
end

for j = 1:4
    load(inputname{j})
    speed = speed(timerange(1):timerange(2),:);
    fspeed_part = fspeed_part(:,timerange(1):timerange(2));
        
        
      %Fit anonymous function
    g = fittype(factor1fit);
    f1 = fit(I_part', vmax_part', g);
    Probval1(j) = Prob_cal([f1.I1a f1.I1b f1.I1c],I,speed,factor1);
    
    figure(3)
    subplot(2,2,j)
    plot(I_part,vmax_part,'O')
    hold
    plot(f1)
    ylim([-70 0])
    
    figure(4)
    vdf = fspeed_part./(f1(I_part)*ones(size(speed,1),1)');
    subplot(2,2,j)
    plot(vdf')
    ylabel('speed')
    xlabel('time')
    title(inputname{j})
end
